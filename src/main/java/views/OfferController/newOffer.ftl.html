<#import "../layout/defaultLayout.ftl.html" as layout> <@layout.myLayout "Ofertas">
<div class="container">


	<div class="row">

		<div class="col s12">
			<div class="card-panel  white margined-top">
				<form id="newOfferForm" action="/saveOffer" method="post" class="form-horizontal" novalidate>


					<div id="errors">
					</div>

					<div class="row">
						<div class="input-field col s12">
							<h4>${i18n("offer.details")}</h4>
						</div>
					</div>
					<div class="row">
						<div class="input-field col s12">
							<input placeholder="${i18n('offer.title.placeholder')}" id="title" name="title"  type="text"
								   class="validate" required aria-required="true" value="<#if offer??>${(offer.title)!}</#if>">
							<label for="title">${i18n("offer.title")}</label>
						</div>
					</div>
					<div class="row">	
						<div class="input-field col s12">
							<textarea id="description" name="description" placeholder="${i18n('offer.description.placeholder')}"
									  class="validate" value="<#if offer??>${(offer.description)!}</#if>"></textarea><br/>
							<label for="description">${i18n("offer.description")}</label>
						</div>
					</div>
					<div class="row">
						<div class="input-field col s6">
							<input id="startDate" name="startDateInternship" type="date" class="datepicker" readonly="false" required>
							<label for="startDate">${i18n("offer.startDate")}</label>
						</div>
						<div class="input-field col s6">
							<input id="endDate" name="endDate" type="date" class="datepicker" required>
							<label for="endDate">${i18n("offer.endDate")}</label>
						</div>
					</div>
					<div class="row">
						<div class="input-field col s12 m4 l4">
							<input type="checkbox" id="locomotion" name="hasLocomotion" value="true"/>
							<label for="locomotion">${i18n("offer.hasLocomotion")}</label>
						</div>
						<div class="input-field col s12 m4 l4">
							<input type="checkbox" id="income" name="hasIncome" value="true"/>
							<label for="income">${i18n("offer.hasIncome")}</label>
						</div>
						<div class="input-field col s12 m4 l4">
							<input type="checkbox" id="lunch" name="hasLunch" value="true"/>
							<label for="lunch">${i18n("offer.hasLunch")}</label>
						</div>
					</div>
					<br/>
					<div class="row">
						<div class="input-field col s12">
							<select id="offerId" name="offerTypeId" class="validate" required>
								<option value="" disabled selected>Seleccione</option>
								<#list offerTypes as type>
									<option value="${type.id}">${type.name}</option>
								</#list>
							</select>
							<label for="offerId">${i18n("offer.type")}</label>
						</div>
					</div>
					<div class="row">
						<div class="input-field col s12">
							<input type="text" id="offerLocation" name="location" required
                                   class="validate" aria-required="true"/>
							<label for="offerLocation">${i18n("offer.location")}</label>
						</div>
					</div>
					<div class="row">
						<div class="input-field col s12">
							<input type="text" id="offerArea" name="area"/>
							<label for="offerArea">${i18n("offer.area")}</label>
						</div>
					</div>
					<div class="row">
						<div class="input-field col s12">
							<input type="text" id="offerPosition" name="position"/>
							<label for="offerPosition">${i18n("offer.position")}</label>
						</div>
					</div>

					<div class="row">
						<div class="input-field col s6">
							<input id="startDateAvailable" name="startDateAvailable" type="date" class="datepicker" readonly="false" required>
							<label for="startDateAvailable">${i18n("offer.startDateAvailable")}</label>
						</div>
						<div class="input-field col s6">
							<input id="endDateAvailable" name="endDateAvailable" type="date" class="datepicker" required>
							<label for="endDateAvailable">${i18n("offer.endDateAvailable")}</label>
						</div>
					</div>

					<div class="row">
						<div class="input-field col s12">
							<h4>${i18n("offer.requirements")}</h4>
						</div>
					</div>

					<div class="row">
						<div class="input-field col s12">
							<select name="careers" multiple required>
								<option value="" disabled selected>Seleccione</option>
								<#list careers as career>
									<option value="${career.careerId}">${career.careerName}</option>
								</#list>
							</select>
							<label>${i18n("offer.career")}</label>
						</div>
					</div>
					<div class="row valign-wrapper">
						<div class="input-field col s6">
							<input type="number" id="offerLevelRequired" name="minimalLevelRequired" min="1" max="12"/>
							<label for="offerLevelRequired">${i18n("offer.levelRequired")}</label>
						</div>
						<div class="col s6">
							<span class="valign">Semestre</span>
						</div>
					</div>
					<div class="row">
						<div class="input-field col s12">
							<input type="text" id="language" name="language"/>
							<label for="language">${i18n("offer.language")}</label>
						</div>
					</div>
					<button type="submit" class="btn waves-effect waves-light">${i18n("offer.submit")}<i class="material-icons right">send</i></button>
				</form>
			</div>
		</div>
	</div>
</div>

	<!-- Modal Structure -->
	<div id="loadingModal"  class="modal ">
		<div class="modal-content">
			<div class="preloader-wrapper small active">
				<div class="spinner-layer spinner-blue">
					<div class="circle-clipper left">
						<div class="circle"></div>
					</div><div class="gap-patch">
					<div class="circle"></div>
				</div><div class="circle-clipper right">
					<div class="circle"></div>
				</div>
				</div>
			</div>
			<div>
				cargando...
			</div>
		</div>
	</div>


	<script type="text/javascript">
	
	/*$('.datepicker').pickadate({
	    selectMonths: true, // Creates a dropdown to control month
	    selectYears: 15 // Creates a dropdown of 15 years to control year
	});*/


	$('.datepicker').pickadate({
		selectMonths: true,//Creates a dropdown to control month
		selectYears: 15,//Creates a dropdown of 15 years to control year
		//The title label to use for the month nav buttons
		labelMonthNext: 'Próximo Mes',
		labelMonthPrev: 'Mes Anterior',
		//The title label to use for the dropdown selectors
		labelMonthSelect: 'Seleccione Mes',
		labelYearSelect: 'Seleccione año',
		//Months and weekdays
		monthsFull: [ '${i18n("datepicker.january")!}', '${i18n("datepicker.february")!}', '${i18n("datepicker.march")!}', '${i18n("datepicker.april")!}', '${i18n("datepicker.may")!}', '${i18n("datepicker.june")!}', '${i18n("datepicker.july")!}', '${i18n("datepicker.august")!}', '${i18n("datepicker.september")!}', '${i18n("datepicker.october")!}', '${i18n("datepicker.november")!}', '${i18n("datepicker.december")!}' ],
		monthsShort: [ '${i18n("datepicker.jan")}', '${i18n("datepicker.feb")}', '${i18n("datepicker.mar")}', '${i18n("datepicker.apr")}', '${i18n("datepicker.may")}', '${i18n("datepicker.jun")}', '${i18n("datepicker.jul")}', '${i18n("datepicker.aug")}', '${i18n("datepicker.sep")}', '${i18n("datepicker.oct")}', '${i18n("datepicker.nov")}', '${i18n("datepicker.dec")}' ],
		weekdaysFull: [ 'Domingo', 'Lunes', 'Martes', 'Miercoles', 'Jueves', 'Viernes', 'Sábado' ],
		weekdaysShort: [ 'Dom', 'Lun', 'Mar', 'Mie', 'Jue', 'Vie', 'Sab' ],
		//Materialize modified
		weekdaysLetter: [ 'D', 'L', 'M', 'M', 'J', 'V', 'S' ],
		//Today and clear
		today: 'Hoy',
		clear: 'Limpiar',
		close: 'Cerrar',
		//The format to show on the `input` element
		format: 'd mmmm, yyyy',
		
	});

	$('#startDate').pickadate({
		onSet: function(context) {
		    console.log('Just set stuff:', context)


			var $input = $('#endDate').pickadate();
			var picker = $input.pickadate('picker');

			picker.set('max', '-1');
		}
	});


	$(document).ready(function() {
		$('select').material_select();
		$('#description').materialnote();
	});



	$('form').submit(function (e) {

		// stop the form from submitting the normal way and refreshing the page
		event.preventDefault();
		e.returnValue = false;


		var $toastContent = $(' ');


		$('#loadingModal').openModal();

		$.ajax({
			url: "/validateOffer",
			type: "post",
			data: $('#newOfferForm').serialize(),
			dataType: "json"
		})
		// using the done promise callback
		.done(function(data) {

			// log data to the console so we can see
			console.log("success!");

			//clearing handler
			$('form').off('submit');

			//actually submit the form
			$('form').submit();

		})
		.fail(function (data) {
			// here we will handle errors and validation messages
			console.log("error");
			console.log(data);

			var errorInfo = "";
			$.each(data.responseJSON.violations, function (key, value) {
				Materialize.toast(value.field + " " + value.constraintViolation.messageKey, 4000);
			});

		})
		.always(function (){
			$('#loadingModal').closeModal();
		})


		;


	});



</script>

</@layout.myLayout>
