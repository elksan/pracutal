<#import "../layout/defaultLayout.ftl.html" as layout> 
<@layout.myLayout "Ofertas">  

<div class="container">
	
	<div class="row">
        <div class="col s12 m4 l3">
            <div id="aside">
                <br/>
                <#if session.role == "2"|| session.role == "1">
                    <a href="/newOffer" class="waves-effect waves-light btn-large">Nueva Oferta</a>

                <#elseif session.role == "3">
                    <a href="/myApplications" class="waves-effect waves-light btn-large">Mis Postulaciones</a>
                </#if>

                <div id="filters" class="collection z-depth-1">
                    <a id="showAll" class="collection-item active" data-filter="*">${i18n("offers.showAll")}<span class="badge">${offers?size}</span></a>

                    <#list offerTypes as offerType>
                        <a href="#!" class="collection-item" data-filter="${offerType.id}">${offerType.name}<span class="badge">${offerType.offers?size}</span></a>
                        <#else>
                    </#list>

                </div>


            </div>
        </div>
		<div class="col s12 m8 l9 ">
            <div>
                <#list offers>
                    <ul id="offerList" class="collection z-depth-1">
                        <#items  as offer>
                            <li id="offerBlock" class="collection-item offer-item avatar" data-type="${offer.offerType.id}" data-id="${offer.organization.id}">
                                <div class="row">
                                    <div class="col s1">
                                        <img src="/assets/images/company-logo.jpg" alt="" class="circle">
                                    </div>
                                    <div class="col s7">
                                        <h5>${offer.title}</h5>
                                        <p>
                                            <strong>${(offer.organization.name)!"N/A"}</strong> en ${offer.location}
                                        </p>
                                    </div>
                                    <div class="col s4">

                                            <div class="chip indigo">
                                                ${offer.offerType.name}
                                            </div>

                                    </div>

                                        <div class="fixed-action-btn horizontal" >
                                            <a class="btn-floating btn-large red">
                                                <i class="material-icons">menu</i>
                                            </a>
                                            <ul>
                                                <li><a href="/offerDetails/${offer.id}" class="btn-floating green tooltipped"
                                                       data-position="bottom" data-delay="50" data-tooltip="${i18n("offer.seeDetails")}"><i class="material-icons right">details</i></a></li>
                                                <#if session.role == "1" || session.role == "4" || (session.role == "2" && session.userId == offer.organization.id?c)>

                                                    <li><a href="/deleteOffer/${offer.id}" class="btn-floating yellow tooltipped <#if session.role == "2" && offer.approved>disabled</#if>"
                                                            data-position="bottom" data-delay="50" data-tooltip="${i18n("offer.delete")}"><i class="material-icons right">delete</i></a></li>
                                                    <li><a href="/editOffer/${offer.id}" class="btn-floating blue tooltipped <#if session.role == "2" && offer.approved>disabled</#if>"
                                                            data-position="bottom" data-delay="50" data-tooltip="${i18n("offer.edit")}"><i class="material-icons right">edit</i></a></li>

                                                </#if>

                                            </ul>
                                        </div>
                                </div>
                            </li>
                        </#items>
                    </ul>
                <#else>
                    <p>No hay ofertas disponibles</p>
                </#list>

            </div>
		</div>
	</div>



    <!-- Modal Structure -->
    <div id="deleteOffer" class="modal">
        <div class="modal-content">
            <h4>${i18n("offers.deleteOffer")}</h4>
            <p>${i18n("offers.deleteOfferMessage")}</p>
        </div>
        <div class="modal-footer">
            <a href="#!" class=" modal-action modal-close waves-effect waves-green btn-flat">${i18n("offers.offerDeleteAccept")}</a>
        </div>
    </div>

</div>
<script type="text/javascript">
    $(document).ready(function() {

        $('.navbar li.active').removeClass('active');
        $('#menus #offers-btn').addClass('active');


    });
       // init Isotope
    var $grid = $('#offerList').isotope({
        itemSelector: '.offer-item',
        layoutMode: 'vertical'
    });

    /*$('#filters a').on('click', function() {
     $(this).toggleClass(
     "active");
     });*/

    // filter functions
    var filterFns = {

        1: function() {
            var type = $(this).data('type');
            return type == '1';
        },
        2: function() {
            var type = $(this).data('type');
            return type == '2';
        },
        3: function() {
            var type = $(this).data('type');
            return type == '3';
        },
        4: function() {
            var type = $(this).data('type');
            return type == '4';
        },
        5: function() {
            var type = $(this).data('type');
            return type == '5';
        },
    };

    // bind filter button click
    $('#filters').on( 'click', 'a', function() {
        var filterValue = $( this ).data('filter');
        // use filterFn if matches value
        filterValue = filterFns[ filterValue ] || filterValue;
        $grid.isotope({ filter: filterValue });

        $('#filters a').removeClass('active');
        $(this).addClass('active');
    });


</script>
</@layout.myLayout>